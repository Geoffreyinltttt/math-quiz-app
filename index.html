<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™®é«˜æ•¸å­¸ä½ å¤šæœƒæ¨å»£æ¨£èª²-3A</title>
    
    <!-- React ç›¸é—œ CDN -->
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        
        * {
            font-family: 'Noto Sans TC', sans-serif;
        }
        
        body {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* æ•¸å­¸ä½ å¤šæœƒå“ç‰Œè‰²ç³» */
        :root {
          --brand-primary: #FF87B0;
          --brand-secondary: #FFB347;
          --brand-primary-light: rgba(255, 135, 176, 0.1);
          --brand-secondary-light: rgba(255, 179, 71, 0.1);
          --brand-gradient: linear-gradient(135deg, #FF87B0, #FFB347);
          --brand-gradient-hover: linear-gradient(135deg, #FF77A0, #FFA337);
        }

        /* é¦–é å¡ç‰‡ç¾åŒ– */
        .group:hover {
          transform: translateY(-2px);
          box-shadow: 0 4px 15px rgba(255, 135, 176, 0.15);
          border-color: var(--brand-primary) !important;
          transition: all 0.3s ease;
        }

        /* æŒ‰éˆ•æ¨£å¼æ›¿æ› */
        .bg-blue-500, .bg-green-500, .bg-yellow-500 {
          background: var(--brand-gradient) !important;
          border: none;
          transition: all 0.3s ease;
        }

        .hover\:bg-blue-600:hover, 
        .hover\:bg-green-600:hover, 
        .hover\:bg-yellow-600:hover {
          background: var(--brand-gradient-hover) !important;
          transform: translateY(-2px);
        }

        /* é€²åº¦æ¢æ¨£å¼ */
        .bg-zinc-700, .bg-blue-600 {
          background: var(--brand-gradient) !important;
        }

        /* ç­”é¡Œåé¥‹æ¨£å¼ */
        .bg-emerald-50, .bg-green-100 {
          background-color: var(--brand-secondary-light) !important;
        }

        .border-emerald-200, .border-green-200 {
          border-color: var(--brand-secondary) !important;
        }

        .bg-red-50 {
          background-color: var(--brand-primary-light) !important;
        }

        .border-red-200 {
          border-color: var(--brand-primary) !important;
        }

        .bg-emerald-500 {
          background-color: var(--brand-secondary) !important;
        }

        .bg-red-500 {
          background-color: var(--brand-primary) !important;
        }

        /* è§£ææ¡†æ¨£å¼ */
        .bg-yellow-50 {
          background-color: var(--brand-secondary-light) !important;
        }

        .border-yellow-200 {
          border-color: var(--brand-secondary) !important;
        }
		/* å‹•ç•«æ•ˆæœ */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.animate-fadeIn {
  animation: fadeIn 0.5s ease-out forwards;
}

/* ç‚ºæ¯å€‹å–®å…ƒé …æ·»åŠ äº¤éŒ¯å‡ºç¾çš„å‹•ç•« */
@keyframes slideIn {
  from { opacity: 0; transform: translateX(-20px); }
  to { opacity: 1; transform: translateX(0); }
}

.grid button:nth-child(1) { animation: slideIn 0.3s ease-out 0.1s both; }
.grid button:nth-child(2) { animation: slideIn 0.3s ease-out 0.15s both; }
.grid button:nth-child(3) { animation: slideIn 0.3s ease-out 0.2s both; }
.grid button:nth-child(4) { animation: slideIn 0.3s ease-out 0.25s both; }
.grid button:nth-child(5) { animation: slideIn 0.3s ease-out 0.3s both; }
.grid button:nth-child(6) { animation: slideIn 0.3s ease-out 0.35s both; }
.grid button:nth-child(7) { animation: slideIn 0.3s ease-out 0.4s both; }
.grid button:nth-child(8) { animation: slideIn 0.3s ease-out 0.45s both; }
.grid button:nth-child(9) { animation: slideIn 0.3s ease-out 0.5s both; }
.grid button:nth-child(10) { animation: slideIn 0.3s ease-out 0.55s both; }
.grid button:nth-child(11) { animation: slideIn 0.3s ease-out 0.6s both; }

/* é€²åº¦æ¢å‹•ç•« */
@keyframes progressFill {
  from { width: 0; }
  to { width: var(--progress-width); }
}

.grid button .bg-gradient-to-r {
  animation: progressFill 1s ease-out 0.7s forwards;
}
@keyframes pulse {
    0% {
        opacity: 0.8;
    }
    50% {
        opacity: 1;
    }
    100% {
        opacity: 0.8;
    }
}

.animate-pulse {
    animation: pulse 2s infinite;
}

/* å·²ç¶“æ·»åŠ çš„é–å®šæ¨£å¼*/
.cursor-not-allowed {
    cursor: not-allowed;
}

.filter.grayscale {
    filter: grayscale(100%);
}

.quiz-container {
  background: linear-gradient(to bottom right, rgba(255, 255, 255, 0.8), rgba(255, 240, 245, 0.6));
  border-radius: 16px;
  padding: 20px;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
  border: 1px solid rgba(255, 135, 176, 0.1);
}

.quiz-question-image {
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  border: 1px solid rgba(255, 135, 176, 0.2);
  padding: 8px;
  background-color: #FDFDFD;
  margin-bottom: 16px;
}

/* è§£æåœ–ç‰‡ç¾åŒ– */
.quiz-explanation-image {
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  border: 1px solid rgba(255, 179, 71, 0.2);
  padding: 8px;
  background-color: #FDFDFD;
}

/* æ‰‹æ©Ÿè¢å¹•é©æ‡‰æ¨£å¼ */
@media (max-width: 640px) {
  /* æ•´é«”é–“è·èª¿æ•´ */
  .p-8 {
    padding: 1rem !important;
  }
  
  .p-6 {
    padding: 0.75rem !important;
  }
  
  /* å­—é«”å¤§å°èª¿æ•´ */
  .text-3xl {
    font-size: 1.5rem !important;
  }
  
  .text-2xl {
    font-size: 1.25rem !important;
  }
  
  .text-xl {
    font-size: 1.125rem !important;
  }
  
  /* å…ƒç´ å¤§å°èª¿æ•´ */
  .w-12 {
    width: 2.5rem !important;
  }
  
  .h-12 {
    height: 2.5rem !important;
  }
  
  .w-10 {
    width: 2rem !important;
  }
  
  .h-10 {
    height: 2rem !important;
  }
  
  /* æŒ‰éˆ•å…ƒç´ èª¿æ•´ */
  .rounded-3xl {
    border-radius: 1rem !important;
  }
  
  .rounded-2xl {
    border-radius: 0.75rem !important;
  }
  
  /* é–“è·èª¿æ•´ */
  .space-x-4 > * + * {
    margin-left: 0.75rem !important;
  }
  
  .mb-10 {
    margin-bottom: 1.5rem !important;
  }
  
  /* é ­åƒå€åŸŸèª¿æ•´ */
  header img {
    height: 3.5rem !important;
  }
  
  /* å–®å…ƒé¸æ“‡é é¢èª¿æ•´ */
  .grid.gap-4 {
    gap: 0.5rem !important;
  }
  
  /* é€²åº¦æ¢å¯¬åº¦èª¿æ•´ */
  .w-20 {
    width: 3rem !important;
  }
}

/* æ¥µå°è¢å¹•é©æ‡‰æ¨£å¼ */
@media (max-width: 360px) {
  /* æ›´ç·Šæ¹Šçš„ä½ˆå±€ */
  .p-5 {
    padding: 0.5rem !important;
  }
  
  /* æ›´å°çš„å­—é«” */
  .text-lg {
    font-size: 1rem !important;
  }
  
  .text-sm {
    font-size: 0.75rem !important;
  }
  
  /* æ›´å°çš„åœ–æ¨™ */
  .w-6, .h-6 {
    width: 1.25rem !important;
    height: 1.25rem !important;
  }
  
  .w-5, .h-5 {
    width: 1rem !important;
    height: 1rem !important;
  }
  
  /* æ¸›å°‘é–“è· */
  .space-x-6 > * + * {
    margin-left: 0.5rem !important;
  }
  
  .space-x-4 > * + * {
    margin-left: 0.5rem !important;
  }
}
/* é˜²æ­¢æ–‡å­—è¢«é¸ä¸­ */
.user-select-none {
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    -webkit-touch-callout: none;
}
/* åˆªé™¤ç·šå‹•ç•«æ•ˆæœ */
@keyframes strikethrough {
  from { width: 0; }
  to { width: 100%; }
}

.strike-animation {
  animation: strikethrough 0.3s ease-out forwards;
}

/* é•·æŒ‰æŒ‡ç¤ºå‹•ç•« - ä¿®æ”¹ç‚ºæ›´æ˜é¡¯çš„æ•ˆæœ */
@keyframes pulse-border {
  0% { box-shadow: 0 0 0 0 rgba(255, 135, 176, 0.7); }
  70% { box-shadow: 0 0 0 8px rgba(255, 135, 176, 0); }
  100% { box-shadow: 0 0 0 0 rgba(255, 135, 176, 0); }
}

.long-press-indicator {
  animation: pulse-border 1s infinite;
}

/* åˆªé™¤ç·šå‹•ç•«æ•ˆæœ - åŠ å¿«é€Ÿåº¦ä¸¦å¢å¼·å¯è¦‹æ€§ */
@keyframes strikethrough {
  from { width: 0; }
  to { width: 100%; }
}

/* æ–°å¢ï¼šæ’é™¤éç¨‹ä¸­çš„é¡ï¼Œç¢ºä¿å‹•ç•«å…ˆç™¼ç”Ÿ */
.excluding-option::before {
  content: "";
  position: absolute;
  top: 50%;
  left: 0;
  right: 0;
  height: 2px;
  background-color: rgba(239, 68, 68, 0.9); /* æ›´æ˜é¡¯çš„ç´…è‰² */
  animation: strikethrough 0.15s ease-out forwards;
  z-index: 30;
}

/* æ–°å¢ï¼šå–æ¶ˆæ’é™¤éç¨‹ä¸­çš„é¡ */
.removing-exclusion::before {
  content: "";
  position: absolute;
  top: 50%;
  left: 0;
  right: 0;
  height: 2px;
  background-color: rgba(239, 68, 68, 0.5);
  animation: strikethrough 0.15s ease-out reverse forwards;
  z-index: 30;
}

/* è§¸æ‘¸åé¥‹æ•ˆæœ */
.touch-active {
  transform: scale(0.98);
  transition: transform 0.1s ease-out;
}

/* å·²æ’é™¤é¸é …çš„æ¨£å¼åŠ å¼· */
.excluded .option-text {
  text-decoration: line-through;
  color: #9ca3af;
}

.excluded {
  opacity: 0.7;
}
    </style>
</head>
<body class="bg-white">
    <div id="app"></div>

    <script type="text/babel">
    // å–®å…ƒåˆ—è¡¨
    const topics = [
        "å–®å…ƒ01 å¼§åº¦é‡",
        "å–®å…ƒ02 ä¸‰è§’å‡½æ•¸çš„åœ–å½¢",
        "å–®å…ƒ03 ä¸‰è§’çš„å’Œå·®è§’å…¬å¼",
        "å–®å…ƒ04 æ­£é¤˜å¼¦çš„ç–Šåˆ",
        "å–®å…ƒ05 æŒ‡æ•¸å‡½æ•¸",
        "å–®å…ƒ06 å°æ•¸èˆ‡å°æ•¸å¾‹",
        "å–®å…ƒ07 å°æ•¸å‡½æ•¸",
        "å–®å…ƒ08 å¹³é¢å‘é‡",
        "å–®å…ƒ09 å¹³é¢å‘é‡çš„é‹ç®—",
        "å–®å…ƒ10 äºŒå…ƒä¸€æ¬¡è¯ç«‹æ–¹ç¨‹å¼"
    ];

        // é¡Œç›®è³‡æ–™
const unitQuestions = {
    "å–®å…ƒ01 å¼§åº¦é‡": [
        {
            id: "1-1",
            questionImage: "https://hackmd.io/_uploads/rJPu0j2qJe.png",
            options: [
                { text: "O", value: "O" },
                { text: "X", value: "X" }
            ],
            correctAnswer: "X",
            explanationImage: "https://hackmd.io/_uploads/rJFIvn3qyx.png"
        },
        {
            id: "1-2",
            questionImage: "https://hackmd.io/_uploads/rkkhX2n5ke.png",
            options: [
                { text: "O", value: "O" },
                { text: "X", value: "X" }
            ],
            correctAnswer: "O",
            explanationImage: null
        },
        {
            id: "1-3",
            questionImage: "https://hackmd.io/_uploads/rJWNmNks1x.png",
            options: [
                { image: "https://hackmd.io/_uploads/rkyrE4ks1x.png", value: "A" },
                { image: "https://hackmd.io/_uploads/B19_EEkj1l.png", value: "B" },
                { image: "https://hackmd.io/_uploads/S1HKVNJoyx.png", value: "C" },
                { image: "https://hackmd.io/_uploads/Bklc44Jiyx.png", value: "D" },
                { image: "https://hackmd.io/_uploads/SkYcV4ks1g.png", value: "E" }
            ],
            correctAnswer: "D",
            explanationImage: "https://hackmd.io/_uploads/S12sEVkoJl.png"
        },
        {
            id: "1-4",
            questionImage: "https://hackmd.io/_uploads/B1hAVVyoyl.png",
            options: [
                { image: "https://hackmd.io/_uploads/BJXmBVJs1l.png", value: "A" },
                { image: "https://hackmd.io/_uploads/HJmNBV1skg.png", value: "B" },
                { image: "https://hackmd.io/_uploads/r1RNrEkj1l.png", value: "C" },
                { image: "https://hackmd.io/_uploads/Hyj8r4yo1g.png", value: "D" },
                { image: "https://hackmd.io/_uploads/BkIwrEJoJx.png", value: "E" }
            ],
            correctAnswer: "B",
            explanationImage: "https://hackmd.io/_uploads/HJ8y8VkjJe.png"
        },
        {
            id: "1-5",
            questionImage: "https://hackmd.io/_uploads/rJ9Z8N1jke.png",
            options: [
                { image: "https://hackmd.io/_uploads/SkrmIE1i1g.png", value: "A" },
                { image: "https://hackmd.io/_uploads/H1lV8Nysye.png", value: "B" },
                { image: "https://hackmd.io/_uploads/rJ2SIN1o1e.png", value: "C" },
                { image: "https://hackmd.io/_uploads/HJvUL4yo1l.png", value: "D" },
                { image: "https://hackmd.io/_uploads/HJnw84JoJe.png", value: "E" }
            ],
            correctAnswer: "E",
            explanationImage: "https://hackmd.io/_uploads/rJlqUEkokx.png"
        },
        {
            id: "1-6",
            questionImage: "https://hackmd.io/_uploads/rJi6LEkjkg.png",
            options: [
                { text: "O", value: "O" },
                { text: "X", value: "X" }
            ],
            correctAnswer: "O",
            explanationImage: "https://hackmd.io/_uploads/SJZ1PV1ike.png"
        },
        {
            id: "1-7",
            questionImage: "https://hackmd.io/_uploads/B1MxDV1i1x.png",
            options: [
                { image: "https://hackmd.io/_uploads/B1JZvEyskx.png", value: "A" },
                { image: "https://hackmd.io/_uploads/HJ5ZwVJskl.png", value: "B" },
                { image: "https://hackmd.io/_uploads/BkzfP4ysJg.png", value: "C" },
                { image: "https://hackmd.io/_uploads/HJ2zDN1jyl.png", value: "D" },
                { image: "https://hackmd.io/_uploads/r147DN1okx.png", value: "E" }
            ],
            correctAnswer: "D",
            explanationImage: "https://hackmd.io/_uploads/H1R4wE1jkg.png"
        },
        {
            id: "1-8",
            questionImage: "https://hackmd.io/_uploads/Sy3ivN1iyx.png",
            options: [
                { image: "https://hackmd.io/_uploads/By90FEkoyl.png", value: "A" },
                { image: "https://hackmd.io/_uploads/HJVycNkj1g.png", value: "B" },
                { image: "https://hackmd.io/_uploads/H1g-5NJiyl.png", value: "C" },
                { image: "https://hackmd.io/_uploads/ry7MqNkjJe.png", value: "D" },
                { image: "https://hackmd.io/_uploads/HyeQ5V1syl.png", value: "E" }
            ],
            correctAnswer: "E",
            explanationImage: "https://hackmd.io/_uploads/rJUV541oye.png"
        },
        {
            id: "1-9",
            questionImage: "https://hackmd.io/_uploads/HyX26VJi1e.png",
            options: [
                { image: "https://hackmd.io/_uploads/rJs6aEkoyl.png", value: "A" },
                { image: "https://hackmd.io/_uploads/BJERaVkskx.png", value: "B" },
                { image: "https://hackmd.io/_uploads/B1gJCVyiJe.png", value: "C" },
                { image: "https://hackmd.io/_uploads/B1cy0EJiyl.png", value: "D" },
                { image: "https://hackmd.io/_uploads/SkBgAE1iyx.png", value: "E" }
            ],
            correctAnswer: "D",
            explanationImage: "https://hackmd.io/_uploads/rkp-CVkjye.png"
        },
        {
            id: "1-10",
            questionImage: "https://hackmd.io/_uploads/rJ2Q04yiJl.png",
            options: [
                { image: "https://hackmd.io/_uploads/ry8SA4ksJg.png", value: "A" },
                { image: "https://hackmd.io/_uploads/HJfURNJjke.png", value: "B" },
                { image: "https://hackmd.io/_uploads/r1jIR4JjJg.png", value: "C" },
                { image: "https://hackmd.io/_uploads/SkMwREkoJx.png", value: "D" },
                { image: "https://hackmd.io/_uploads/rk5wAEyoye.png", value: "E" }
            ],
            correctAnswer: "C",
            explanationImage: "https://hackmd.io/_uploads/rkE9R4yikx.png"
        },
        {
            id: "1-11",
            questionImage: "https://hackmd.io/_uploads/Hy9nC41skl.png",
            options: [
                { image: "https://hackmd.io/_uploads/rksTRN1ikl.png", value: "A" },
                { image: "https://hackmd.io/_uploads/HyQR0EJske.png", value: "B" },
                { image: "https://hackmd.io/_uploads/SJp0REyjJl.png", value: "C" },
                { image: "https://hackmd.io/_uploads/BJPykHks1e.png", value: "D" },
                { image: "https://hackmd.io/_uploads/HyggkS1j1x.png", value: "E" }
            ],
            correctAnswer: "E",
            explanationImage: "https://hackmd.io/_uploads/HJt8kS1oJl.png"
        },
        {
            id: "1-12",
            questionImage: "https://hackmd.io/_uploads/r1TjkHyjke.png",
            options: [
                { image: "https://hackmd.io/_uploads/SJc-xSJskg.png", value: "A" },
                { image: "https://hackmd.io/_uploads/HJmzeSkiJl.png", value: "B" },
                { image: "https://hackmd.io/_uploads/Hk6zxBysye.png", value: "C" },
                { image: "https://hackmd.io/_uploads/B1HQgBys1x.png", value: "D" },
                { image: "https://hackmd.io/_uploads/r12XlHyikx.png", value: "E" }
            ],
            correctAnswer: "D",
            explanationImage: "https://hackmd.io/_uploads/H1fwlHJsJl.png"
        },
        {
            id: "1-13",
            questionImage: "https://hackmd.io/_uploads/S1dFxryo1g.png",
            options: [
                { image: "https://hackmd.io/_uploads/B1LjlSyoyl.png", value: "A" },
                { image: "https://hackmd.io/_uploads/SJkhgSki1l.png", value: "B" },
                { image: "https://hackmd.io/_uploads/SkBngSkjkg.png", value: "C" },
                { image: "https://hackmd.io/_uploads/Sy1Tgryokl.png", value: "D" },
                { image: "https://hackmd.io/_uploads/HkdagBkikg.png", value: "E" }
            ],
            correctAnswer: "B",
            explanationImage: "https://hackmd.io/_uploads/r1qyMrJoye.png"
        },
        {
            id: "1-14",
            questionImage: "https://hackmd.io/_uploads/BkXWzryike.png",
            options: [
                { image: "https://hackmd.io/_uploads/BJYhMSJskg.png", value: "A" },
                { image: "https://hackmd.io/_uploads/HJFAGHksyl.png", value: "B" },
                { image: "https://hackmd.io/_uploads/BkGkQBko1x.png", value: "C" },
                { image: "https://hackmd.io/_uploads/H1JZQSyoye.png", value: "D" },
                { image: "https://hackmd.io/_uploads/SkemXrJjkg.png", value: "E" }
            ],
            correctAnswer: "C",
            explanationImage: "https://hackmd.io/_uploads/BJmVQHJikx.png"
        },
        {
            id: "1-15",
            questionImage: "https://hackmd.io/_uploads/Hy-IQr1oyx.png",
            options: [
                { image: "https://hackmd.io/_uploads/SkjLmSJskx.png", value: "A" },
                { image: "https://hackmd.io/_uploads/H1XOQSkiyx.png", value: "B" },
                { image: "https://hackmd.io/_uploads/r15qmrJsye.png", value: "C" },
                { image: "https://hackmd.io/_uploads/BytomSJjJe.png", value: "D" },
                { image: "https://hackmd.io/_uploads/B1W3XHkoyl.png", value: "E" }
            ],
            correctAnswer: "B",
            explanationImage: "https://hackmd.io/_uploads/BJv0QBJjyx.png"
        }
    ]
};


        // é€²åº¦ç®¡ç†å·¥å…·
const ProgressManager = {
    getProgress: () => {
        try {
            const progress = localStorage.getItem('mathQuizProgress');
            return progress ? JSON.parse(progress) : {};
        } catch (error) {
            console.error('Error reading progress:', error);
            return {};
        }
    },
    
    setProgress: (topic, round) => {
        try {
            const currentProgress = ProgressManager.getProgress();
            const newProgress = {
                ...currentProgress,
                [topic]: Math.max(round, currentProgress[topic] || 0)
            };
            localStorage.setItem('mathQuizProgress', JSON.stringify(newProgress));
            return newProgress;
        } catch (error) {
            console.error('Error saving progress:', error);
            return {};
        }
    },
    
    resetProgress: (topic) => {
        try {
            const currentProgress = ProgressManager.getProgress();
            const newProgress = {
                ...currentProgress,
                [topic]: 0
            };
            localStorage.setItem('mathQuizProgress', JSON.stringify(newProgress));
            return newProgress;
        } catch (error) {
            console.error('Error resetting progress:', error);
            return {};
        }
    }
};

// HomePage çµ„ä»¶
function HomePage({ onStartQuiz }) {
    return (
        <div className="p-8 max-w-2xl mx-auto">
            <div className="space-y-6">
                {/* åˆ·é¡Œå°é«˜æ‰‹æŒ‰éˆ• */}
                <button 
                    onClick={() => onStartQuiz('åˆ·é¡Œæ•‘æ•¸å­¸')} 
                    className="w-full group bg-white p-6 rounded-3xl border border-zinc-100 hover:border-zinc-200 hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1"
                >
                    <div className="flex items-center space-x-4">
                        <div className="flex-shrink-0 w-12 h-12 rounded-full bg-gradient-to-br from-pink-300 to-amber-300 flex items-center justify-center">
                            <svg className="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                            </svg>
                        </div>
                        <div className="flex-1">
                            <h3 className="text-2xl text-zinc-800 mb-1 font-normal text-left">åˆ·é¡Œå°é«˜æ‰‹</h3>
                            <p className="text-zinc-500 text-left">é€éè§£é¡ŒåŸ¹é¤Šæ•¸å­¸æ€ç¶­èƒ½åŠ›</p>
                        </div>
                        <div className="text-zinc-300 group-hover:text-pink-400 transition-colors">
                            <svg className="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" d="M9 5l7 7-7 7" />
                            </svg>
                        </div>
                    </div>
                </button>
                
                {/* é›²ç«¯æ•™å®¤æŒ‰éˆ• */}
                <a 
                    href=" https://sites.google.com/view/62003-111/%E9%A6%96%E9%A0%81" 
                    target="_blank" 
                    rel="noopener noreferrer" 
                    className="w-full group bg-white p-6 rounded-3xl border border-zinc-100 hover:border-zinc-200 hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1 block"
                >
                    <div className="flex items-center space-x-4">
                        <div className="flex-shrink-0 w-12 h-12 rounded-full bg-gradient-to-br from-pink-300 to-amber-300 flex items-center justify-center">
                            <svg className="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
                            </svg>
                        </div>
                        <div className="flex-1">
                            <h3 className="text-2xl text-zinc-800 mb-1 font-normal text-left">é›²ç«¯æ•™å®¤</h3>
                            <p className="text-zinc-500 text-left">è§€çœ‹æ•™ç§‘æ›¸å½±éŸ³è§£é¡ŒæŒæ¡é—œéµæ¦‚å¿µ</p>
                        </div>
                        <div className="text-zinc-300 group-hover:text-pink-400 transition-colors">
                            <svg className="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                            </svg>
                        </div>
                    </div>
                </a>

                {/* å­¸æ¸¬æ•¸å­¸å…¬å¼éš¨èº«è®€æŒ‰éˆ• */}
                <a 
                    href="https://sites.google.com/view/math-card-lt/%E9%A6%96%E9%A0%81" 
                    target="_blank" 
                    rel="noopener noreferrer" 
                    className="w-full group bg-white p-6 rounded-3xl border border-zinc-100 hover:border-zinc-200 hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1 block"
                >
                    <div className="flex items-center space-x-4">
                        <div className="flex-shrink-0 w-12 h-12 rounded-full bg-gradient-to-br from-pink-300 to-amber-300 flex items-center justify-center">
                            <svg className="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                            </svg>
                        </div>
                        <div className="flex-1">
                            <h3 className="text-2xl text-zinc-800 mb-1 font-normal text-left">å­¸æ¸¬æ•¸å­¸å…¬å¼éš¨èº«è®€</h3>
                            <p className="text-zinc-500 text-left">å­¸æ¸¬å¿…å‚™çš„æ•¸å­¸å…¬å¼ä¸€æŠŠç½©</p>
                        </div>
                        <div className="text-zinc-300 group-hover:text-pink-400 transition-colors">
                            <svg className="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                            </svg>
                        </div>
                    </div>
                </a>
            </div>
        </div>
    );
}


function TopicSelection({ onSelectTopic, onBack, topicProgress }) {
    // ç‚ºæ¯å€‹å–®å…ƒåˆ†é…ç¨ç‰¹çš„èƒŒæ™¯é¡è‰²
    const getUnitColors = (index) => {
        const colors = [
            { light: 'from-pink-50 to-amber-50', icon: 'from-pink-300 to-amber-300' },
            { light: 'from-rose-50 to-orange-50', icon: 'from-rose-300 to-orange-300' },
            { light: 'from-fuchsia-50 to-yellow-50', icon: 'from-fuchsia-300 to-yellow-300' },
            { light: 'from-purple-50 to-amber-50', icon: 'from-purple-300 to-amber-300' },
            { light: 'from-violet-50 to-orange-50', icon: 'from-violet-300 to-orange-300' },
            { light: 'from-indigo-50 to-yellow-50', icon: 'from-indigo-300 to-yellow-300' },
            { light: 'from-blue-50 to-pink-50', icon: 'from-blue-300 to-pink-300' },
            { light: 'from-sky-50 to-rose-50', icon: 'from-sky-300 to-rose-300' },
            { light: 'from-cyan-50 to-fuchsia-50', icon: 'from-cyan-300 to-fuchsia-300' },
            { light: 'from-teal-50 to-purple-50', icon: 'from-teal-300 to-purple-300' },
            { light: 'from-emerald-50 to-violet-50', icon: 'from-emerald-300 to-violet-300' }
        ];
        return colors[index % colors.length];
    };
    
    // æ ¹æ“šå–®å…ƒåç¨±é¸æ“‡æ›´è²¼åˆ‡çš„æ•¸å­¸åœ–æ¨™
const getUnitIcon = (title) => {
    const icons = {
        'å–®å…ƒ01 å¼§åº¦é‡': (
            <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                {/* å¼§åº¦é‡ç¬¦è™Ÿ - åœ“å¼§å’Œè§’åº¦ */}
                <circle cx="12" cy="12" r="7" strokeWidth="2" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 5v7l5 5" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 12l-3 3" strokeDasharray="3 2" />
            </svg>
        ),
        'å–®å…ƒ02 ä¸‰è§’å‡½æ•¸çš„åœ–å½¢': (
            <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                {/* ä¸‰è§’å‡½æ•¸æ­£å¼¦æ›²ç·š */}
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 12h16" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 18c2-6 4-6 6 0s4 6 6 0 4-6 6 0" />
            </svg>
        ),
        'å–®å…ƒ03 ä¸‰è§’çš„å’Œå·®è§’å…¬å¼': (
            <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                {/* å’Œå·®è§’å…¬å¼ç¬¦è™Ÿ */}
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M5 12h6M8 9v6M15 9h4M15 15h4M15 12h4" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M8 17l8-10" strokeDasharray="1 1" />
            </svg>
        ),
        'å–®å…ƒ04 æ­£é¤˜å¼¦çš„ç–Šåˆ': (
            <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                {/* æ­£é¤˜å¼¦ç–Šåˆæ³¢å½¢ */}
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 12h16" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" d="M4 9c2 6 4 6 6 0s4-6 6 0 4 6 6 0" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" d="M4 15c2-6 4-6 6 0s4 6 6 0 4-6 6 0" stroke="#6b7280" />
            </svg>
        ),
        'å–®å…ƒ05 æŒ‡æ•¸å‡½æ•¸': (
            <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                {/* æŒ‡æ•¸å‡½æ•¸æ›²ç·š */}
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 20h16M4 20v-8" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 16c1 0 2-1 3-2s2-3 3-4 2-3 3-4 2-2 3-2 2 0 4 0" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M7 8h1M7 8v1" strokeDasharray="1" />
            </svg>
        ),
        'å–®å…ƒ06 å°æ•¸èˆ‡å°æ•¸å¾‹': (
            <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                {/* å°æ•¸ç¬¦è™Ÿ log */}
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M8 6h3M8 12h3M8 18h3M6 6v12M14 9l2-3" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 18h4M17 14v4" />
            </svg>
        ),
        'å–®å…ƒ07 å°æ•¸å‡½æ•¸': (
            <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                {/* å°æ•¸å‡½æ•¸æ›²ç·š */}
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 12h16M12 4v16" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M20 12c-6-5-10-6-12-6s-3 1-4 6" />
            </svg>
        ),
        'å–®å…ƒ08 å¹³é¢å‘é‡': (
            <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                {/* å¹³é¢å‘é‡ç¬¦è™Ÿ */}
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 12h16M12 4v16" strokeDasharray="1 2" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 6l10 10" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M16 16l-2 2M16 16l2 0M16 16l0 2" />
            </svg>
        ),
        'å–®å…ƒ09 å¹³é¢å‘é‡çš„é‹ç®—': (
            <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                {/* å‘é‡é‹ç®— - å’Œèˆ‡å·® */}
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 10l6-4" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 14l6 4" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M18 10l-6-4" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M18 14l-6 4" />
                <circle cx="6" cy="12" r="2" strokeWidth="2" />
                <circle cx="18" cy="12" r="2" strokeWidth="2" />
                <circle cx="12" cy="6" r="2" strokeWidth="2" />
                <circle cx="12" cy="18" r="2" strokeWidth="2" />
            </svg>
        ),
        'å–®å…ƒ10 äºŒå…ƒä¸€æ¬¡è¯ç«‹æ–¹ç¨‹å¼': (
            <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                {/* è¯ç«‹æ–¹ç¨‹å¼ - å…©ç›´ç·šç›¸äº¤ */}
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 20L20 4" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 4l16 16" />
                <circle cx="12" cy="12" r="1.5" strokeWidth="2" fill="currentColor" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1" d="M6 8h2M8 6v2M16 18h2M18 16v2" strokeDasharray="1" />
            </svg>
        )
    };
        
        // æ‰¾å‡ºæœ€åŒ¹é…çš„åœ–æ¨™
        for (const key in icons) {
            if (title.includes(key)) {
                return icons[key];
            }
        }
        
        // å¦‚æœæ‰¾ä¸åˆ°å°æ‡‰çš„åœ–æ¨™ï¼Œä½¿ç”¨æ•¸å­¸ç¬¦è™Ÿçš„åœ–æ¨™
        return (
            <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 4v16m-8-8h16M9 9l6 6M15 9l-6 6" />
            </svg>
        );
    };

    return (
        <div className="p-6 md:p-8 max-w-3xl mx-auto animate-fadeIn">
            <div className="mb-10 text-center md:text-left">
                <h2 className="text-3xl text-zinc-800 mb-3 font-light">å–®å…ƒé¸æ“‡</h2>
                <p className="text-zinc-500">é¸æ“‡æƒ³è¦ç·´ç¿’çš„æ•¸å­¸ä¸»é¡Œé–‹å§‹å­¸ç¿’</p>
            </div>
            
            <div className="grid gap-4 mb-8">
                {topics.map((topic, index) => {
                    const progress = topicProgress[topic] || 0;
                    const unit = topic.match(/å–®å…ƒ\d+/)[0];
                    const title = topic.replace(/å–®å…ƒ\d+\s/, '');
                    const colors = getUnitColors(index);
                    const unitIcon = getUnitIcon(title);
                    
                    // è¨­å®šé–å®šç‹€æ…‹ - åªæœ‰å–®å…ƒ01æ˜¯æœªé–å®šçš„
                    const isLocked = !topic.includes("å–®å…ƒ01");
                    
                    return (
                        <button
                            key={index}
                            onClick={isLocked ? undefined : () => onSelectTopic(topic)}
                            className={`
                                group bg-white p-5 rounded-2xl border border-zinc-100 
                                ${isLocked ? 'cursor-not-allowed' : 'hover:border-zinc-200 hover:shadow-xl transform hover:-translate-y-1'}
                                transition-all duration-300 w-full overflow-hidden relative
                                ${progress > 0 ? 'bg-gradient-to-r ' + colors.light : ''}
                                ${isLocked ? 'opacity-70' : ''}
                                relative
                            `}
                        >
                            {/* é–å®šåœ–æ¨™ */}
                            {isLocked && (
                                <span className="absolute top-1/2 right-6 transform -translate-y-1/2 text-2xl z-20 text-zinc-600 animate-pulse">
                                    ğŸ”’
                                </span>
                            )}
                            
                            {/* æ–°çš„ä½ˆå±€çµæ§‹ï¼Œç¢ºä¿ä¸€è‡´çš„å°é½Š */}
                            <div className="grid grid-cols-12 items-center gap-0 relative z-10">
                                {/* åœ–æ¨™å€åŸŸï¼Œå›ºå®šå¯¬åº¦ */}
                                <div className="col-span-1">
                                    <div className={`
                                        flex-shrink-0 w-10 h-10 rounded-xl 
                                        bg-gradient-to-br ${colors.icon}
                                        flex items-center justify-center text-white
                                        shadow-md ${isLocked ? 'filter grayscale' : 'group-hover:shadow-lg'} 
                                        transition-all duration-300
                                    `}>
                                        {unitIcon}
                                    </div>
                                </div>
                                
                                {/* å–®å…ƒç·¨è™Ÿèˆ‡ä¸»é¡Œæ–‡å­—ï¼Œå›ºå®šå°é½Š */}
                                <div className="col-span-7 pl-2">
                                    <div className="flex flex-col items-start">
                                        <span className="text-xs font-medium text-zinc-400 block">{unit}</span>
                                        <span className="text-zinc-700 text-lg block">{title}</span>
                                    </div>
                                </div>
                                
                                {/* é€²åº¦èˆ‡ç®­é ­å€åŸŸï¼Œå›ºå®šå°é½Š */}
                                <div className="col-span-4 flex items-center justify-end">
                                    {progress > 0 && (
                                        <div className="flex items-center mr-3">
                                            <div className="bg-white/50 rounded-full h-1.5 w-16 overflow-hidden shadow-inner">
                                                <div 
                                                    className={`
                                                        bg-gradient-to-r ${colors.icon} h-1.5 rounded-full 
                                                        transition-all duration-500 ease-out shadow
                                                    `}
                                                    style={{width: `${(progress/3)*100}%`}}
                                                ></div>
                                            </div>
                                            <span className="text-sm font-medium text-zinc-600 text-center ml-2 w-8">
                                                {progress === 3 ? (
                                                    <span className="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-gradient-to-r from-pink-300 to-amber-300 text-white">
                                                        å®Œæˆ
                                                    </span>
                                                ) : `${progress}/3`}
                                            </span>
                                        </div>
                                    )}
                                    <div className="text-zinc-400 group-hover:text-pink-500 transition-colors">
                                        <svg className={`w-6 h-6 transform ${isLocked ? '' : 'group-hover:translate-x-1'} transition-transform duration-300`} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" d="M9 5l7 7-7 7" />
                                        </svg>
                                    </div>
                                </div>
                            </div>
                            
                            {/* è£é£¾æ€§èƒŒæ™¯å…ƒç´  */}
                            <div className="absolute -right-12 -bottom-12 w-40 h-40 rounded-full bg-gradient-to-br from-transparent to-white/10 pointer-events-none"></div>
                            <div className="absolute -left-12 -top-12 w-32 h-32 rounded-full bg-gradient-to-br from-white/10 to-transparent pointer-events-none"></div>
                            
                            {/* æ‡¸åœæ™‚é¡¯ç¤ºçš„æç¤º */}
                            {isLocked && (
                                <div className="absolute inset-0 flex items-center justify-center opacity-0 bg-black/70 group-hover:opacity-100 transition-opacity duration-300 z-10 rounded-2xl">
                                    <p className="text-white font-medium">èª²ç¨‹å°šæœªé–‹æ”¾</p>
                                </div>
                            )}
                        </button>
                    );
                })}
            </div>
        </div>
    );
}

		// ResumePrompt çµ„ä»¶
function ResumePrompt({ topic, progress, onChoice, onBack }) {
    return (
        <div className="p-4 max-w-md mx-auto">
            <h2 className="text-xl font-bold mb-4 text-center">
                {topic}
            </h2>
            <div className="bg-blue-100 border-l-4 border-blue-500 p-4 mb-6">
                <p className="text-blue-700">
                    æ‚¨å·²ç¶“å®Œæˆäº† {progress} å›åˆçš„ç·´ç¿’ï¼æ˜¯å¦è¦ç¹¼çºŒï¼Ÿ
                </p>
            </div>
            <p className="text-lg mb-6 text-center">
                è«‹é¸æ“‡æ‚¨è¦å¦‚ä½•ç¹¼çºŒï¼š
            </p>
            <button 
                onClick={() => onChoice('continue')}
                className="w-full mb-3 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"
            >
                ç¹¼çºŒä¸‹ä¸€å›åˆ
            </button>
            <button 
                onClick={() => onChoice('restart')}
                className="w-full mb-3 py-3 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 transition-colors"
            >
                é‡æ–°é–‹å§‹æ­¤å–®å…ƒ
            </button>
            <button 
                onClick={onBack}
                className="w-full py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors"
            >
                è¿”å›å–®å…ƒé¸æ“‡
            </button>
        </div>
    );
}
	
        // ReviewPrompt çµ„ä»¶
        function ReviewPrompt({ topic, onChoice, onBack }) {
            return (
                <div className="p-4 max-w-md mx-auto">
                    <h2 className="text-xl font-bold mb-4 text-center">
                        {topic}
                    </h2>
                    <div className="bg-green-100 border-l-4 border-green-500 p-4 mb-6">
                        <p className="text-green-700">
                            æ­å–œï¼æ‚¨å·²ç¶“å®Œæˆäº†é€™å€‹å–®å…ƒçš„æ‰€æœ‰ç·´ç¿’ï¼
                        </p>
                    </div>
                    <p className="text-lg mb-6 text-center">
                        éœ€è¦é‡æ–°è¤‡ç¿’ä¸€æ¬¡å—ï¼Ÿ
                    </p>
                    <button 
                        onClick={() => onChoice('restart')}
                        className="w-full mb-3 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"
                    >
                        é‡æ–°é–‹å§‹ç·´ç¿’
                    </button>
                    <button 
                        onClick={onBack}
                        className="w-full py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors"
                    >
                        è¿”å›å–®å…ƒé¸æ“‡
                    </button>
                </div>
            );
        }

        // Quiz çµ„ä»¶
       function Quiz({ topic, onFinish, initialRound, onUpdateProgress }) {
    const [allQuestions, setAllQuestions] = React.useState([]);
    const [currentQuestions, setCurrentQuestions] = React.useState([]);
    const [currentQuestion, setCurrentQuestion] = React.useState(0);
    const [selectedAnswer, setSelectedAnswer] = React.useState(null);
    const [showFeedback, setShowFeedback] = React.useState(false);
    const [isCorrect, setIsCorrect] = React.useState(false);
    const [quizComplete, setQuizComplete] = React.useState(false);
    const [wrongQuestions, setWrongQuestions] = React.useState([]);
    const [correctAnswers, setCorrectAnswers] = React.useState(0);
    const [round, setRound] = React.useState(initialRound);
    const [showExplanation, setShowExplanation] = React.useState(false);
    const [isReviewingWrongQuestions, setIsReviewingWrongQuestions] = React.useState(false);
    
    // æ–°å¢ç”¨æ–¼åˆªå»æ³•çš„ç‹€æ…‹
    const [excludedAnswers, setExcludedAnswers] = React.useState([]);
    const [longPressTimeout, setLongPressTimeout] = React.useState(null);
    const [submitMode, setSubmitMode] = React.useState(false);

    const shuffleArray = React.useCallback((array) => {
        const shuffled = [...array];
        for (let i = shuffled.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
        }
        return shuffled;
    }, []);

    React.useEffect(() => {
        const topicQuestions = unitQuestions[topic] || [];
        const roundQuestions = topicQuestions.slice((round - 1) * 5, round * 5);
        setAllQuestions(roundQuestions);
    }, [topic, round, shuffleArray]);

    React.useEffect(() => {
        setCurrentQuestions(allQuestions);
        setCurrentQuestion(0);
        setCorrectAnswers(0);
        setSelectedAnswer(null);
        setShowFeedback(false);
        setShowExplanation(false);
        setIsReviewingWrongQuestions(false);
        // é‡ç½®åˆªå»æ³•ç‹€æ…‹
        setExcludedAnswers([]);
        setSubmitMode(false);
    }, [allQuestions]);

    // æ–°å¢é•·æŒ‰è™•ç†å‡½æ•¸
    const handleLongPress = (answer) => {
  if (showFeedback) return;
  
  const optionButton = document.querySelector(`button[data-option="${answer}"]`);
  
  // å¦‚æœé¸é …å·²è¢«æ’é™¤ï¼Œå‰‡å–æ¶ˆæ’é™¤
  if (excludedAnswers.includes(answer)) {
    setExcludedAnswers(excludedAnswers.filter(item => item !== answer));
    if (optionButton) optionButton.classList.remove('excluded-option');
  } else {
    // å¦å‰‡å°‡å…¶æ·»åŠ åˆ°æ’é™¤åˆ—è¡¨
    setExcludedAnswers([...excludedAnswers, answer]);
    if (optionButton) optionButton.classList.add('excluded-option');
  }
};

    // è§¸æ§äº‹ä»¶è™•ç†å‡½æ•¸
    const handleTouchStart = (answer) => {
  if (showFeedback) return;
  
  // ç²å–é¸é …æŒ‰éˆ•å…ƒç´ 
  const optionButton = document.querySelector(`button[data-option="${answer}"]`);
  
  // å¦‚æœé¸é …å·²è¢«æ’é™¤ï¼Œæˆ‘å€‘å°‡ç«‹å³é–‹å§‹å–æ¶ˆæ’é™¤çš„è™•ç†
  // ä¸å†ç­‰å¾…é•·æŒ‰æ™‚é–“ï¼Œé€™æ¨£ç”¨æˆ¶å¯ä»¥ç«‹å³çœ‹åˆ°åé¥‹
  if (excludedAnswers.includes(answer)) {
    if (optionButton) {
      // ç«‹å³æ·»åŠ éæ¸¡é¡ï¼Œè¡¨ç¤ºæ­£åœ¨å–æ¶ˆæ’é™¤
      optionButton.classList.add('removing-exclusion');
    }
    
    // å¹¾ä¹ç«‹å³åŸ·è¡Œ(20ms)ï¼Œç¢ºä¿è¦–è¦ºæ•ˆæœèƒ½å¤ é–‹å§‹
    const timeout = setTimeout(() => {
      // å¾æ’é™¤åˆ—è¡¨ä¸­ç§»é™¤
      setExcludedAnswers(prev => prev.filter(item => item !== answer));
      if (optionButton) {
        optionButton.classList.remove('removing-exclusion');
      }
    }, 20);
    
    setLongPressTimeout(timeout);
  } 
  // å¦‚æœé¸é …æœªè¢«æ’é™¤ï¼Œæˆ‘å€‘å°‡æ·»åŠ é•·æŒ‰æŒ‡ç¤ºæ•ˆæœ
  else {
    if (optionButton) {
      // æ·»åŠ é•·æŒ‰æŒ‡ç¤ºå™¨æ¨£å¼
      optionButton.classList.add('long-press-indicator');
    }
    
    // ç¸®çŸ­é•·æŒ‰æ™‚é–“åˆ°100msï¼Œè®“ç”¨æˆ¶é«”é©—æ›´åŠ éˆæ•
    const timeout = setTimeout(() => {
      // ä¸€æ—¦é”åˆ°é•·æŒ‰æ™‚é–“ï¼Œç«‹å³æ·»åŠ æ’é™¤æ•ˆæœ
      if (optionButton) {
        // æ·»åŠ æº–å‚™æ’é™¤çš„é¡ï¼Œé€™å°‡è§¸ç™¼åˆªé™¤ç·šå‹•ç•«
        optionButton.classList.add('excluding-option');
        
        // åœ¨æ¥µçŸ­çš„å»¶é²å¾Œæ›´æ–°ç‹€æ…‹ï¼Œç¢ºä¿è¦–è¦ºæ•ˆæœå…ˆå•Ÿå‹•
        setTimeout(() => {
          // æ›´æ–°æ’é™¤åˆ—è¡¨
          setExcludedAnswers(prev => [...prev, answer]);
          // ç§»é™¤é•·æŒ‰æŒ‡ç¤ºå™¨æ¨£å¼
          optionButton.classList.remove('long-press-indicator');
          optionButton.classList.remove('excluding-option');
        }, 10);
      }
    }, 100);
    
    setLongPressTimeout(timeout);
  }
};

const handleTouchEnd = () => {
  // æ¸…é™¤ä»»ä½•æ­£åœ¨é€²è¡Œçš„é•·æŒ‰è¨ˆæ™‚å™¨
  if (longPressTimeout) {
    clearTimeout(longPressTimeout);
    setLongPressTimeout(null);
  }
  
  // ç§»é™¤æ‰€æœ‰é¸é …çš„é•·æŒ‰æŒ‡ç¤ºå™¨å’Œéæ¸¡é¡
  document.querySelectorAll('.long-press-indicator, .excluding-option, .removing-exclusion').forEach(el => {
    el.classList.remove('long-press-indicator');
    el.classList.remove('excluding-option');
    el.classList.remove('removing-exclusion');
  });
};

// ä¿®æ”¹é»æ“Šè™•ç†å‡½æ•¸ï¼Œç°¡åŒ–é‚è¼¯
const handleAnswerClick = (answer) => {
  if (showFeedback) return;
  
  // é¸é …å·²è¢«æ’é™¤çš„æƒ…æ³ä¸‹ï¼Œé»æ“Šæœƒå–æ¶ˆæ’é™¤
  if (excludedAnswers.includes(answer)) {
    // ç«‹å³å¾æ’é™¤åˆ—è¡¨ä¸­ç§»é™¤
    setExcludedAnswers(prev => prev.filter(item => item !== answer));
    return;
  }
  
  // å¦å‰‡ï¼Œè¨­ç½®é¸æ“‡çš„ç­”æ¡ˆä¸¦å•Ÿç”¨æäº¤æ¨¡å¼
  setSelectedAnswer(answer);
  setSubmitMode(true);
};

    // æäº¤ç­”æ¡ˆå‡½æ•¸
    const submitAnswer = () => {
        setShowFeedback(true);
        const correct = selectedAnswer === currentQuestions[currentQuestion].correctAnswer;
        setIsCorrect(correct);

        if (correct) {
            setCorrectAnswers(correctAnswers + 1);
        } else {
            if (isReviewingWrongQuestions) {
                setShowExplanation(true);
            }
            if (!isReviewingWrongQuestions) {
                setWrongQuestions([...wrongQuestions, currentQuestions[currentQuestion]]);
            }
        }
    };

    // ä¿®æ”¹å¾Œçš„ä¸‹ä¸€é¡Œå‡½æ•¸
    const nextQuestion = () => {
        if (currentQuestion < currentQuestions.length - 1) {
            setCurrentQuestion(currentQuestion + 1);
            setSelectedAnswer(null);
            setShowFeedback(false);
            setShowExplanation(false);
            setExcludedAnswers([]);  // é‡ç½®æ’é™¤é¸é …
            setSubmitMode(false);    // é‡ç½®æäº¤æ¨¡å¼
        } else {
            setQuizComplete(true);
            if (!isReviewingWrongQuestions) {
                onUpdateProgress(round);
            }
        }
    };

    const handleOptionClick = (option) => {
        switch(option) {
            case 'retry':
                setIsReviewingWrongQuestions(true);
                setCurrentQuestions(shuffleArray(wrongQuestions));
                setQuizComplete(false);
                setCurrentQuestion(0);
                setCorrectAnswers(0);
                setSelectedAnswer(null);
                setShowFeedback(false);
                setShowExplanation(false);
                setExcludedAnswers([]);  // é‡ç½®æ’é™¤é¸é …
                setSubmitMode(false);    // é‡ç½®æäº¤æ¨¡å¼
                break;
            case 'nextRound':
                if (round < 3) {
                    setRound(prev => prev + 1);
                    setWrongQuestions([]);
                    setIsReviewingWrongQuestions(false);
                    setQuizComplete(false);
                    setExcludedAnswers([]);  // é‡ç½®æ’é™¤é¸é …
                    setSubmitMode(false);    // é‡ç½®æäº¤æ¨¡å¼
                } else {
                    onFinish('topics');
                }
                break;
            case 'newTopic':
                onFinish('topics');
                break;
            case 'home':
                onFinish('home');
                break;
        }
    };

    // ä¿®æ”¹å¾Œçš„é¸é …æ¸²æŸ“å‡½æ•¸
    // ä¿®æ”¹å¾Œçš„é¸é …æ¸²æŸ“å‡½æ•¸
const renderQuestionOptions = (q) => {
    return (
        <div className="space-y-3">
            {q.options.map((option, index) => {
                const isExcluded = excludedAnswers.includes(option.value);
                
                return (
                    <button
                        key={index}
                        data-option={option.value}
                        onClick={() => handleAnswerClick(option.value)}
                        onTouchStart={() => handleTouchStart(option.value)}
                        onTouchEnd={handleTouchEnd}
                        onTouchCancel={handleTouchEnd}
                        disabled={showFeedback}
                        className={`
                            w-full p-4 rounded-xl transition-all
                            border flex items-center justify-between user-select-none
                            ${showFeedback && selectedAnswer === option.value
                                ? isCorrect
                                    ? 'bg-teal-50 border-teal-300 text-teal-800' 
                                    : 'bg-pink-50 border-pink-300 text-pink-800'
                                : isExcluded
                                    ? 'bg-white border-slate-200 text-slate-400 opacity-80 excluded'
                                    : selectedAnswer === option.value && !showFeedback
                                        ? 'bg-slate-100 border-slate-300 text-slate-800'
                                        : 'bg-white border-slate-200 text-slate-800 hover:bg-slate-50'
                            }
                            relative
                        `}
                    >
                        {/* åˆªé™¤ç·šæ•ˆæœ - ç¾åœ¨ä¾è³´CSSé¡ï¼Œä¸å†ä½¿ç”¨ç¨ç«‹çš„divä¾†å¯¦ç¾ */}
                        <div className="flex items-center relative z-10">
                            <span className={`
                                flex-shrink-0 w-6 h-6 mr-3 rounded-full
                                flex items-center justify-center
                                ${showFeedback && selectedAnswer === option.value
                                    ? isCorrect
                                        ? 'bg-gradient-to-r from-emerald-400 to-green-500 text-white'
                                        : 'bg-gradient-to-r from-pink-400 to-red-400 text-white'
                                    : selectedAnswer === option.value && !showFeedback
                                        ? 'bg-slate-300 text-white'
                                        : 'border-2 border-slate-300'
                                }
                            `}>
                                {showFeedback && selectedAnswer === option.value && (
                                    isCorrect 
                                        ? <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M5 13l4 4L19 7" />
                                          </svg>
                                        : <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
                                          </svg>
                                )}
                                {selectedAnswer === option.value && !showFeedback && (
                                    <div className="w-2 h-2 bg-white rounded-full"></div>
                                )}
                            </span>
                            {option.text && <span className="option-text">{option.text}</span>}
                            {option.image && (
                                <div className={`quiz-option-image ml-2`}>
                                    <img src={option.image} alt={`é¸é … ${option.value}`} className="h-8 object-contain" />
                                </div>
                            )}
                        </div>
                    </button>
                );
            })}
        </div>
    );
};

    const q = currentQuestions[currentQuestion];
    if (!q) return <div>è¼‰å…¥ä¸­...</div>;

    const progress = ((currentQuestion + 1) / currentQuestions.length) * 100;

    if (quizComplete) {
        const message = isReviewingWrongQuestions 
            ? "æ­å–œä½ å®Œæˆäº†éŒ¯é¡Œç·´ç¿’ï¼" 
            : `æ‚¨å·²å®Œæˆç¬¬ ${round} å›åˆçš„é¡Œç›®ã€‚`;
            
        return (
            <div className="p-4 max-w-md mx-auto">
                <h2 className="text-xl font-bold mb-4 text-center">
                    {message}
                </h2>
                
                {!isReviewingWrongQuestions && (
                    <div className="mt-6 p-6 bg-gradient-to-br from-pink-100 to-amber-100 rounded-2xl shadow-lg">
                        <div className="flex flex-col items-center space-y-4">
                            {/* å‹•æ…‹çå‹µåœ–æ¨™ */}
                            <div className="animate-bounce">
                                {correctAnswers === 5 ? (
                                    <svg className="w-16 h-16 text-amber-500" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                                    </svg>
                                ) : correctAnswers >= 3 ? (
                                    <svg className="w-16 h-16 text-pink-500" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                                    </svg>
                                ) : (
                                    <svg className="w-16 h-16 text-zinc-400" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5s.67 1.5 1.5 1.5zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z"/>
                                    </svg>
                                )}
                            </div>
                            
                            {/* å¾—åˆ†åœ“åœˆ */}
                            <div className="relative">
                                <svg className="w-32 h-32" viewBox="0 0 36 36">
                                    <path 
                                        d="M18 2.0845
                                        a 15.9155 15.9155 0 0 1 0 31.831
                                        a 15.9155 15.9155 0 0 1 0 -31.831"
                                        fill="none"
                                        stroke="#eee"
                                        strokeWidth="3"
                                    />
                                    <path 
                                        d="M18 2.0845
                                        a 15.9155 15.9155 0 0 1 0 31.831
                                        a 15.9155 15.9155 0 0 1 0 -31.831"
                                        fill="none"
                                        stroke={correctAnswers === 5 ? "url(#goldGradient)" : correctAnswers >= 3 ? "url(#pinkGradient)" : "url(#grayGradient)"}
                                        strokeWidth="3"
                                        strokeDasharray={`${correctAnswers * 20}, 100`}
                                    />
                                </svg>
                                
                                {/* æ¼¸å±¤å®šç¾© */}
                                <svg width="0" height="0">
                                    <defs>
                                        <linearGradient id="goldGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                            <stop offset="0%" style={{stopColor:"#FFD700", stopOpacity:1}} />
                                            <stop offset="100%" style={{stopColor:"#FFA500", stopOpacity:1}} />
                                        </linearGradient>
                                        <linearGradient id="pinkGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                            <stop offset="0%" style={{stopColor:"#FF69B4", stopOpacity:1}} />
                                            <stop offset="100%" style={{stopColor:"#FF1493", stopOpacity:1}} />
                                        </linearGradient>
                                        <linearGradient id="grayGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                            <stop offset="0%" style={{stopColor:"#A9A9A9", stopOpacity:1}} />
                                            <stop offset="100%" style={{stopColor:"#708090", stopOpacity:1}} />
                                        </linearGradient>
                                    </defs>
                                </svg>
                                
                                <div className="absolute inset-0 flex items-center justify-center">
                                    <span className="text-3xl font-bold text-zinc-800">
                                        {correctAnswers * 20}%
                                    </span>
                                </div>
                            </div>
                            
                            {/* æ–‡å­—æè¿° */}
                            <div className="text-center">
                                <h3 className="text-xl font-bold mb-2">
                                    {correctAnswers === 5 
                                        ? "å®Œç¾ï¼å¤ªæ£’äº†ï¼" 
                                        : correctAnswers >= 3 
                                            ? "åšå¾—å¾ˆå¥½ï¼" 
                                            : "ç¹¼çºŒåŠ æ²¹ï¼"
                                    }
                                </h3>
                                <p className="text-zinc-600">
                                    æ‚¨åœ¨é€™å›åˆä¸­ç­”å°äº† {correctAnswers} é¡Œï¼Œç­”å°ç‡ç‚º {correctAnswers * 20}%
                                </p>
                            </div>
                        </div>
                    </div>
                )}
                
                {/* å¦‚æœæœ‰éŒ¯é¡Œä¸”é‚„æ²’é€²è¡ŒéŒ¯é¡Œç·´ç¿’ï¼Œåªé¡¯ç¤ºéŒ¯é¡Œç·´ç¿’æŒ‰éˆ• */}
                {wrongQuestions.length > 0 && !isReviewingWrongQuestions && (
                    <button 
                        onClick={() => handleOptionClick('retry')} 
                        className="w-full mb-3 py-3 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 transition-colors"
                    >
                        éŒ¯é¡Œå†ä¾†ä¸€æ¬¡
                    </button>
                )}
                
                {/* åªæœ‰åœ¨æ²’æœ‰éŒ¯é¡Œæˆ–å·²å®ŒæˆéŒ¯é¡Œç·´ç¿’æ™‚ï¼Œæ‰é¡¯ç¤ºä¸‹ä¸€æ­¥é¸é … */}
                {(wrongQuestions.length === 0 || isReviewingWrongQuestions) && (
                    <div>
                        {round < 3 && (
                            <button 
                                onClick={() => handleOptionClick('nextRound')} 
                                className="w-full mb-3 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"
                            >
                                é€²å…¥ä¸‹ä¸€å›åˆ
                            </button>
                        )}
                        
                        {round === 3 && (
                            <button 
                                onClick={() => handleOptionClick('newTopic')} 
                                className="w-full mb-3 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors"
                            >
                                é¸æ“‡æ–°å–®å…ƒ
                            </button>
                        )}
                        
                        <button 
                            onClick={() => handleOptionClick('home')} 
                            className="w-full py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors"
                        >
                            å›åˆ°é¦–é 
                        </button>
                    </div>
                )}
            </div>
        );
    }

    return (
        <div className="p-4 max-w-md mx-auto relative">
            <div className="quiz-container">
                <div className="text-sm text-zinc-500 mb-2 italic">
                    æç¤ºï¼šé•·æŒ‰é¸é …å¯å°‡å…¶æ’é™¤
                </div>
                <div className="mb-4 bg-gray-200 rounded-full h-2.5 dark:bg-gray-700">
                    <div className="bg-blue-600 h-2.5 rounded-full" style={{width: `${progress}%`}}></div>
                </div>
                <h2 className="text-xl font-bold mb-4">{topic} - ç¬¬ {round} å›åˆ</h2>
                <div className="quiz-question-image">
                    <img src={q.questionImage} alt="é¡Œç›®" className="w-full" />
                </div>
                {renderQuestionOptions(q)}
                
                {/* æäº¤æŒ‰éˆ• */}
                {submitMode && !showFeedback && (
                    <button
                        onClick={submitAnswer}
                        className="w-full mt-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors"
                    >
                        æäº¤ç­”æ¡ˆ
                    </button>
                )}
                
                {showFeedback && (
                    <div className={`mt-4 p-4 rounded-lg ${
                        isCorrect 
                            ? 'bg-gradient-to-r from-emerald-50 to-green-100 border border-teal-200 text-teal-800' 
                            : 'bg-gradient-to-r from-pink-50 to-red-50 border border-pink-200 text-pink-800'
                    } flex items-center`}>
                        <span className={`
                            flex-shrink-0 w-8 h-8 mr-3 rounded-full
                            flex items-center justify-center
                            ${isCorrect 
                                ? 'bg-gradient-to-r from-emerald-400 to-green-500' 
                                : 'bg-gradient-to-r from-pink-400 to-red-400'
                            } text-white
                        `}>
                            {isCorrect 
                                ? <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M5 13l4 4L19 7" />
                                </svg>
                                : <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            }
                        </span>
                        <span className="font-medium">
                            {isCorrect ? 'ç­”å°äº†ï¼' : 'ç­”éŒ¯äº†ã€‚'}
                        </span>
                    </div>
                )}
                
                {showExplanation && (
                    <div className="mt-4 border border-yellow-200 rounded-lg overflow-hidden">
                        <div className="bg-yellow-50 px-4 py-2 border-b border-yellow-200">
                            <h3 className="text-yellow-800 font-medium flex items-center">
                                <svg className="w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                è§£æ
                            </h3>
                        </div>
                        <div className="bg-white p-2">
                            <div className="quiz-explanation-image">
                                <img src={q.explanationImage} alt="é¡Œç›®è§£æ" className="w-full" />
                            </div>
                        </div>
                    </div>
                )}
                
                {showFeedback && (
                    <button
                        onClick={nextQuestion}
                        className="w-full mt-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"
                    >
                        {currentQuestion === currentQuestions.length - 1 ? 'å®Œæˆ' : 'ä¸‹ä¸€é¡Œ'}
                    </button>
                )}
            </div>
        </div>
    );
}


		// Footer çµ„ä»¶
function Footer() {
    return (
        <footer className="bg-white border-t border-zinc-100 py-4 mt-auto">
            <div className="max-w-3xl mx-auto px-4 text-center">
                <p className="text-zinc-600 text-sm mb-1">Longteng Education Co., Ltd. All rights reserved</p>
                <p className="text-zinc-500 text-sm">ç‰ˆæ¬Šæ‰€æœ‰é¾é¨°æ–‡åŒ–äº‹æ¥­è‚¡ä»½æœ‰é™å…¬å¸</p>
            </div>
        </footer>
    );
}

        // App ä¸»çµ„ä»¶
        function App() {
    const [currentPage, setCurrentPage] = React.useState('home');
    const [selectedTopic, setSelectedTopic] = React.useState(null);
    const [topicProgress, setTopicProgress] = React.useState(ProgressManager.getProgress());
    const [startRound, setStartRound] = React.useState(1);

    // æ·»åŠ é›¢é–‹è­¦å‘Š
    React.useEffect(() => {
        const handleBeforeUnload = (e) => {
            // å¦‚æœæ­£åœ¨é€²è¡Œæ¸¬é©—ï¼ˆä¸åœ¨é¦–é ï¼‰ï¼Œå‰‡é¡¯ç¤ºè­¦å‘Š
            if (currentPage !== 'home') {
                const message = "é›¢é–‹é é¢å°‡ç„¡æ³•ä¿å­˜æ‚¨çš„å­¸ç¿’é€²åº¦ã€‚ç¢ºå®šè¦é›¢é–‹å—ï¼Ÿ";
                e.preventDefault();
                e.returnValue = message;
                return message;
            }
        };

        window.addEventListener('beforeunload', handleBeforeUnload);

        // æ¸…ç†äº‹ä»¶ç›£è½å™¨
        return () => {
            window.removeEventListener('beforeunload', handleBeforeUnload);
        };
    }, [currentPage]);

    React.useEffect(() => {
        localStorage.setItem('mathQuizProgress', JSON.stringify(topicProgress));
    }, [topicProgress]);

    const handleStartQuiz = () => {
        setCurrentPage('topics');
    };

    const handleSelectTopic = (topic) => {
        setSelectedTopic(topic);
        const progress = topicProgress[topic] || 0;
        console.log(`é¸æ“‡å–®å…ƒ ${topic}, é€²åº¦: ${progress}`);
        
        if (progress === 3) {
            setCurrentPage('reviewPrompt');
        } else if (progress > 0) {
            setCurrentPage('resumePrompt');
        } else {
            setStartRound(1);
            setCurrentPage('quiz');
        }
    };

    const handleResumeChoice = (choice) => {
        console.log(`é¸æ“‡ ${choice} é€²è¡Œå­¸ç¿’`);
        if (choice === 'restart') {
            const newProgress = ProgressManager.resetProgress(selectedTopic);
            setTopicProgress(newProgress);
            setStartRound(1);
        } else if (choice === 'continue') {
            const currentRound = topicProgress[selectedTopic] || 0;
            setStartRound(currentRound + 1);
        }
        setCurrentPage('quiz');
    };

    return (
        <div className="min-h-screen bg-zinc-50 flex flex-col">
            <header className="bg-white border-b border-zinc-100">
                <div className="max-w-6xl mx-auto px-6 py-3 flex items-center justify-between">
                    {/* å·¦å´è¿”å›æŒ‰éˆ• - åœ¨éé¦–é ä¸”éåˆ·é¡Œæ¨¡å¼æ™‚é¡¯ç¤º */}
                    <div className="w-24">
                        {currentPage !== 'home' && currentPage !== 'quiz' && (
                            <button 
                                onClick={() => setCurrentPage('home')}
                                className="flex items-center space-x-2 text-zinc-500 hover:text-zinc-600 transition-colors"
                            >
                                <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" d="M15 19l-7-7 7-7" />
                                </svg>
                                <span>è¿”å›é¦–é </span>
                            </button>
                        )}
                    </div>
                    
                    {/* ä¸­é–“çš„ logo */}
                    <div className="flex justify-center items-center py-2">
                        <img 
                            src="https://hackmd.io/_uploads/HkWcT8hcyl.png" 
                            alt="Logo" 
                            className="h-16 w-auto object-contain"
                        />
                    </div>
                    
                    {/* ä¿æŒå³å´å°ç¨±çš„ç©ºç™½å€åŸŸ */}
                    <div className="w-24"></div>
                </div>
            </header>
            
            <main className="flex-grow">
                {currentPage === 'home' && (
                    <HomePage onStartQuiz={handleStartQuiz} />
                )}
                
                {currentPage === 'topics' && (
                    <TopicSelection 
                        onSelectTopic={handleSelectTopic} 
                        onBack={() => setCurrentPage('home')} 
                        topicProgress={topicProgress}
                    />
                )}
                
                {currentPage === 'resumePrompt' && (
                    <ResumePrompt 
                        topic={selectedTopic}
                        progress={topicProgress[selectedTopic]}
                        onChoice={handleResumeChoice}
                        onBack={() => setCurrentPage('topics')}
                    />
                )}
                
                {currentPage === 'reviewPrompt' && (
                    <ReviewPrompt 
                        topic={selectedTopic}
                        onChoice={handleResumeChoice}
                        onBack={() => setCurrentPage('topics')}
                    />
                )}
                
                {currentPage === 'quiz' && (
                    <Quiz 
                        key={`${selectedTopic}-${startRound}`}
                        topic={selectedTopic} 
                        onFinish={(destination) => setCurrentPage(destination)}
                        initialRound={startRound}
                        onUpdateProgress={(round) => {
                            const newProgress = ProgressManager.setProgress(selectedTopic, round);
                            setTopicProgress(newProgress);
                        }}
                    />
                )}
            </main>
            
            {/* é è…³çµ„ä»¶ */}
            <Footer />
        </div>
    );
}
        ReactDOM.render(<App />, document.getElementById('app'));
    </script>
</body>
</html>
